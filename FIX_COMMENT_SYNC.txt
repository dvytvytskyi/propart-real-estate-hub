# –í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó –∫–æ–º–µ–Ω—Ç–∞—Ä—ñ–≤ –∑ HubSpot

# –ü—Ä–æ–±–ª–µ–º–∞: –ö–æ–º–µ–Ω—Ç–∞—Ä—ñ –Ω–µ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑—É—é—Ç—å—Å—è –∑ HubSpot, –±–æ —É –ª—ñ–¥–∞ –Ω–µ–º–∞—î hubspot_deal_id

# ============================================================
# –ö–†–û–ö 1: –ü–ï–†–ï–í–Ü–†–ö–ê –õ–Ü–î–ê
# ============================================================

cd /home/pro-part-agent/htdocs/agent.pro-part.online/propart-real-estate-hub

python3 << 'EOF'
from app import app, db, Lead, Comment
with app.app_context():
    # –ó–Ω–∞–π–¥—ñ—Ç—å –ª—ñ–¥ "—Ç–µ—Å—Ç –∫–æ–º–µ–Ω—Ç"
    lead = Lead.query.filter_by(deal_name="—Ç–µ—Å—Ç –∫–æ–º–µ–Ω—Ç").first()
    
    if not lead:
        # –°–ø—Ä–æ–±—É–π—Ç–µ –∑–Ω–∞–π—Ç–∏ –∑–∞ —á–∞—Å—Ç–∏–Ω–æ—é –Ω–∞–∑–≤–∏
        leads = Lead.query.filter(Lead.deal_name.like("%—Ç–µ—Å—Ç%")).all()
        if leads:
            lead = leads[0]
            print(f"–ó–Ω–∞–π–¥–µ–Ω–æ –ª—ñ–¥: {lead.deal_name} (ID: {lead.id})")
    
    if lead:
        print("=" * 80)
        print(f"–õ–Ü–î: {lead.deal_name}")
        print("=" * 80)
        print(f"ID: {lead.id}")
        print(f"hubspot_deal_id: {lead.hubspot_deal_id or '‚ùå –ù–ï –í–°–¢–ê–ù–û–í–õ–ï–ù–û'}")
        print(f"hubspot_contact_id: {lead.hubspot_contact_id or '‚ùå –ù–ï –í–°–¢–ê–ù–û–í–õ–ï–ù–û'}")
        
        if not lead.hubspot_deal_id:
            print("\n‚ö†Ô∏è  –ü–†–û–ë–õ–ï–ú–ê: –õ—ñ–¥ –Ω–µ –º–∞—î hubspot_deal_id!")
            print("   –¶–µ –æ–∑–Ω–∞—á–∞—î, —â–æ –ª—ñ–¥ –±—É–≤ —Å—Ç–≤–æ—Ä–µ–Ω–∏–π –ª–æ–∫–∞–ª—å–Ω–æ –±–µ–∑ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó –∑ HubSpot.")
            print("   –ö–æ–º–µ–Ω—Ç–∞—Ä—ñ –Ω–µ –º–æ–∂—É—Ç—å —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑—É–≤–∞—Ç–∏—Å—è –±–µ–∑ hubspot_deal_id.")
            print("\nüí° –†–Ü–®–ï–ù–ù–Ø:")
            print("   1. –°—Ç–≤–æ—Ä–∏—Ç–∏ deal –≤ HubSpot –¥–ª—è —Ü—å–æ–≥–æ –ª—ñ–¥–∞")
            print("   2. –ê–ë–û —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑—É–≤–∞—Ç–∏ –ª—ñ–¥ –∑ —ñ—Å–Ω—É—é—á–∏–º deal –≤ HubSpot")
        else:
            print(f"\n‚úÖ –õ—ñ–¥ –º–∞—î hubspot_deal_id: {lead.hubspot_deal_id}")
            print("   –ö–æ–º–µ–Ω—Ç–∞—Ä—ñ –ø–æ–≤–∏–Ω–Ω—ñ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑—É–≤–∞—Ç–∏—Å—è.")
        
        # –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –∫–æ–º–µ–Ω—Ç–∞—Ä—ñ
        comments = Comment.query.filter_by(lead_id=lead.id).order_by(Comment.created_at.desc()).all()
        print(f"\n–ö–æ–º–µ–Ω—Ç–∞—Ä—ñ–≤: {len(comments)}")
        for c in comments:
            print(f"  - ID: {c.id}, hubspot_note_id: {c.hubspot_note_id or '‚ùå –ù–ï –°–ò–ù–•–†–û–ù–Ü–ó–û–í–ê–ù–û'}")
    else:
        print("‚ùå –õ—ñ–¥ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ")
EOF

# ============================================================
# –ö–†–û–ö 2: –ü–ï–†–ï–í–Ü–†–ö–ê –õ–û–ì–Ü–í
# ============================================================

echo ""
echo "–û—Å—Ç–∞–Ω–Ω—ñ –ª–æ–≥–∏ –ø—Ä–æ –∫–æ–º–µ–Ω—Ç–∞—Ä—ñ:"
tail -200 logs/propart.log | grep -i "–∫–æ–º–µ–Ω—Ç–∞—Ä\|comment\|hubspot_deal_id\|–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —É–º–æ–≤\|–õ—ñ–¥.*–Ω–µ –º–∞—î hubspot_deal_id" | tail -30

# ============================================================
# –ö–†–û–ö 3: –Ø–ö–©–û –õ–Ü–î –ù–ï –ú–ê–Ñ hubspot_deal_id
# ============================================================

# –í–∞—Ä—ñ–∞–Ω—Ç –ê: –°—Ç–≤–æ—Ä–∏—Ç–∏ deal –≤ HubSpot –¥–ª—è —ñ—Å–Ω—É—é—á–æ–≥–æ –ª—ñ–¥–∞
# (–ü–æ—Ç—Ä—ñ–±–Ω–æ –±—É–¥–µ –¥–æ–¥–∞—Ç–∏ —Ñ—É–Ω–∫—Ü—ñ—é –¥–ª—è —Ü—å–æ–≥–æ)

# –í–∞—Ä—ñ–∞–Ω—Ç –ë: –°–∏–Ω—Ö—Ä–æ–Ω—ñ–∑—É–≤–∞—Ç–∏ –∑ —ñ—Å–Ω—É—é—á–∏–º deal –≤ HubSpot
# (–ü–æ—Ç—Ä—ñ–±–Ω–æ –∑–Ω–∞—Ç–∏ deal ID –∑ HubSpot)

# ============================================================
# –ö–†–û–ö 4: –ü–ï–†–ï–í–Ü–†–ö–ê –ü–Ü–°–õ–Ø –í–ò–ü–†–ê–í–õ–ï–ù–ù–Ø
# ============================================================

# –ü—ñ—Å–ª—è —Ç–æ–≥–æ, —è–∫ hubspot_deal_id –±—É–¥–µ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ:
# 1. –î–æ–¥–∞–π—Ç–µ –Ω–æ–≤–∏–π –∫–æ–º–µ–Ω—Ç–∞—Ä
# 2. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ª–æ–≥–∏
tail -50 logs/propart.log | grep -i "–∫–æ–º–µ–Ω—Ç–∞—Ä\|hubspot\|note"

# 3. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –≤ HubSpot, —á–∏ –∑'—è–≤–∏–≤—Å—è –∫–æ–º–µ–Ω—Ç–∞—Ä

