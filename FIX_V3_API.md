# ‚úÖ –í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–∏–π —Ñ–æ—Ä–º–∞—Ç HubSpot v3 API

## üîß –©–æ –±—É–ª–æ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–æ

### –ü—Ä–æ–±–ª–µ–º–∞
–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞–≤—Å—è –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∏–π —Ñ–æ—Ä–º–∞—Ç API –¥–ª—è –∞—Å–æ—Ü—ñ–∞—Ü—ñ—ó notes –∑ deals (v4 API –∑–∞–º—ñ—Å—Ç—å v3).

### –í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è
–¢–µ–ø–µ—Ä –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–∏–π —Ñ–æ—Ä–º–∞—Ç HubSpot v3 API:

**–°—Ç–≤–æ—Ä–µ–Ω–Ω—è note:**
```
POST /crm/v3/objects/notes
Body: {
  "properties": {
    "hs_note_body": "—Ç–µ–∫—Å—Ç –∫–æ–º–µ–Ω—Ç–∞—Ä—è"
  }
}
```

**–ê—Å–æ—Ü—ñ–∞—Ü—ñ—è note –∑ deal:**
```
PUT /crm/v3/objects/notes/{noteId}/associations/deal/{dealId}/note_to_deal
(–±–µ–∑ body)
```

---

## üìã –ö–æ–º–∞–Ω–¥–∏ –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä—ñ

```bash
cd /home/pro-part-agent/htdocs/agent.pro-part.online/propart-real-estate-hub
git pull origin main
sudo systemctl restart propart
```

---

## üß™ –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è

–ü—ñ—Å–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è:

1. **–î–æ–¥–∞–π—Ç–µ –Ω–æ–≤–∏–π –∫–æ–º–µ–Ω—Ç–∞—Ä** –¥–æ –ª—ñ–¥–∞ –∑ `hubspot_deal_id`
2. **–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ª–æ–≥–∏:**
   ```bash
   sudo journalctl -u propart -f | grep -i "note\|deal\|–∞—Å–æ—Ü—ñ–∞—Ü—ñ—è\|association"
   ```
   
   –®—É–∫–∞–π—Ç–µ:
   - `üìù –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –∞—Å–æ—Ü—ñ–∞—Ü—ñ—ó note X –∑ deal Y` - –∞—Å–æ—Ü—ñ–∞—Ü—ñ—è –ø–æ—á–∞–ª–∞—Å—è
   - `‚úÖ –ù–æ—Ç–∞—Ç–∫–∞ –∞—Å–æ—Ü—ñ–π–æ–≤–∞–Ω–∞ –∑ deal –≤ HubSpot` - —É—Å–ø—ñ—à–Ω–æ
   - `‚ùå –ê—Å–æ—Ü—ñ–∞—Ü—ñ—è –Ω–µ –≤–¥–∞–ª–∞—Å—è` - –ø–æ–º–∏–ª–∫–∞ (–ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ –¥–µ—Ç–∞–ª—ñ)

3. **–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –≤ HubSpot:**
   - –í—ñ–¥–∫—Ä–∏–π—Ç–µ deal –≤ HubSpot
   - –ü–µ—Ä–µ–π–¥—ñ—Ç—å –¥–æ –≤–∫–ª–∞–¥–∫–∏ "Notes" –∞–±–æ "Activity"
   - –ú–∞—î –∑'—è–≤–∏—Ç–∏—Å—è –Ω–æ–≤–∞ –Ω–æ—Ç–∞—Ç–∫–∞ –∑ —Ç–µ–∫—Å—Ç–æ–º –∫–æ–º–µ–Ω—Ç–∞—Ä—è

---

## üß™ –¢–µ—Å—Ç–æ–≤–∏–π —Å–∫—Ä–∏–ø—Ç

–¢–∞–∫–æ–∂ –º–æ–∂–Ω–∞ –ø—Ä–æ—Ç–µ—Å—Ç—É–≤–∞—Ç–∏ –≤—Ä—É—á–Ω—É:

```bash
cd /home/pro-part-agent/htdocs/agent.pro-part.online/propart-real-estate-hub
source venv/bin/activate
python3 test_note_creation.py
deactivate
```

–¶–µ —Å—Ç–≤–æ—Ä–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—É note —Ç–∞ –∞—Å–æ—Ü—ñ—é—î —ó—ó –∑ deal, –ø–æ–∫–∞–∑—É—é—á–∏ –≤—Å—ñ –∫—Ä–æ–∫–∏.

---

## üí° –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î —Ç–µ–ø–µ—Ä

1. **–°—Ç–≤–æ—Ä—é—î—Ç—å—Å—è –∫–æ–º–µ–Ω—Ç–∞—Ä** –≤ –ª–æ–∫–∞–ª—å–Ω—ñ–π –±–∞–∑—ñ –¥–∞–Ω–∏—Ö
2. **–°—Ç–≤–æ—Ä—é—î—Ç—å—Å—è note** –≤ HubSpot —á–µ—Ä–µ–∑ `POST /crm/v3/objects/notes`
3. **–°—Ç–≤–æ—Ä—é—î—Ç—å—Å—è –∞—Å–æ—Ü—ñ–∞—Ü—ñ—è** –º—ñ–∂ note —Ç–∞ deal —á–µ—Ä–µ–∑ `PUT /crm/v3/objects/notes/{noteId}/associations/deal/{dealId}/note_to_deal`

---

## ‚ö†Ô∏è –í–∞–∂–ª–∏–≤–æ

- Notes –±—É–¥—É—Ç—å –∞—Å–æ—Ü—ñ–π–æ–≤–∞–Ω—ñ –∑ deals **–¢–Ü–õ–¨–ö–ò** —è–∫—â–æ –ª—ñ–¥ –º–∞—î `hubspot_deal_id`
- –§–æ—Ä–º–∞—Ç URL: `/crm/v3/objects/notes/{noteId}/associations/deal/{dealId}/note_to_deal`
- PUT –∑–∞–ø–∏—Ç –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è **–±–µ–∑ body** (–ø–æ—Ä–æ–∂–Ω—ñ–π –∑–∞–ø–∏—Ç)

---

## üîç –î—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º

–Ø–∫—â–æ notes –≤—Å–µ —â–µ –Ω–µ –∑'—è–≤–ª—è—é—Ç—å—Å—è –≤ deals:

1. **–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ª–æ–≥–∏ –ø—ñ—Å–ª—è –¥–æ–¥–∞–≤–∞–Ω–Ω—è –∫–æ–º–µ–Ω—Ç–∞—Ä—è:**
   ```bash
   sudo journalctl -u propart -f --since "5 minutes ago" | grep -i "note\|deal\|–∞—Å–æ—Ü—ñ–∞—Ü—ñ—è"
   ```

2. **–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —Ñ–æ—Ä–º–∞—Ç URL –≤ –ª–æ–≥–∞—Ö:**
   - –ú–∞—î –±—É—Ç–∏: `/crm/v3/objects/notes/{noteId}/associations/deal/{dealId}/note_to_deal`
   - –ù–µ –º–∞—î –±—É—Ç–∏: `/crm/v4/...` –∞–±–æ batch API

3. **–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —Å—Ç–∞—Ç—É—Å –∫–æ–¥ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ:**
   - `200`, `201`, –∞–±–æ `204` = —É—Å–ø—ñ—Ö
   - –Ü–Ω—à—ñ –∫–æ–¥–∏ = –ø–æ–º–∏–ª–∫–∞ (–ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –ø–æ–º–∏–ª–∫—É)

