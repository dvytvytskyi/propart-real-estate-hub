# üìÅ –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è AWS S3 –¥–ª—è –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è –¥–æ–∫—É–º–µ–Ω—Ç—ñ–≤

## –©–æ –∑–º—ñ–Ω–µ–Ω–æ

–°–∏—Å—Ç–µ–º–∞ –¥–æ–∫—É–º–µ–Ω—Ç—ñ–≤ —Ç–µ–ø–µ—Ä –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î **AWS S3** –∑–∞–º—ñ—Å—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è —Ñ–∞–π–ª—ñ–≤. –¶–µ –∑–∞–±–µ–∑–ø–µ—á—É—î:
- ‚úÖ –ù–∞–¥—ñ–π–Ω–µ —Ö–º–∞—Ä–Ω–µ –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è
- ‚úÖ –ú–∞—Å—à—Ç–∞–±–æ–≤–∞–Ω—ñ—Å—Ç—å
- ‚úÖ –ë–µ–∑–ø–µ–∫—É
- ‚úÖ –†–µ–∑–µ—Ä–≤–Ω–µ –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è

## –ù–µ–æ–±—Ö—ñ–¥–Ω—ñ –∑–º—ñ–Ω–Ω—ñ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞

–î–æ–¥–∞–π—Ç–µ —Ü—ñ –∑–º—ñ–Ω–Ω—ñ –¥–æ –≤–∞—à–æ–≥–æ `.env` —Ñ–∞–π–ª—É:

```env
# AWS S3 Configuration
AWS_ACCESS_KEY_ID=your_access_key_here
AWS_SECRET_ACCESS_KEY=your_secret_key_here
AWS_S3_BUCKET=your_bucket_name
AWS_REGION=eu-central-1
```

## –Ø–∫ –æ—Ç—Ä–∏–º–∞—Ç–∏ AWSCredentialsCREDENTIALS

### 1. –°—Ç–≤–æ—Ä—ñ—Ç—å AWS –∞–∫–∞—É–Ω—Ç
- –ü–µ—Ä–µ–π–¥—ñ—Ç—å –Ω–∞ https://aws.amazon.com/
- –ó–∞—Ä–µ—î—Å—Ç—Ä—É–π—Ç–µ—Å—å –∞–±–æ —É–≤—ñ–π–¥—ñ—Ç—å

### 2. –°—Ç–≤–æ—Ä—ñ—Ç—å S3 Bucket
1. –í—ñ–¥–∫—Ä–∏–π—Ç–µ AWS Console ‚Üí S3
2. –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å **Create bucket**
3. –í–∫–∞–∂—ñ—Ç—å —É–Ω—ñ–∫–∞–ª—å–Ω—É –Ω–∞–∑–≤—É (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥: `propart-documents`)
4. –í–∏–±–µ—Ä—ñ—Ç—å —Ä–µ–≥—ñ–æ–Ω (—Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–æ: `eu-central-1` –¥–ª—è –Ñ–≤—Ä–æ–ø–∏)
5. **Block Public Access**: –∑–∞–ª–∏—à—Ç–µ –í–°–Ü –≥–∞–ª–æ—á–∫–∏ ‚úÖ (bucket –º–∞—î –±—É—Ç–∏ –ø—Ä–∏–≤–∞—Ç–Ω–∏–º)
6. –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å **Create bucket**

### 3. –ù–∞–ª–∞—à—Ç—É–π—Ç–µ CORS (—è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–µ–Ω –¥–æ—Å—Ç—É–ø –∑ –±—Ä–∞—É–∑–µ—Ä–∞)
1. –í–∏–±–µ—Ä—ñ—Ç—å –≤–∞—à bucket
2. –ü–µ—Ä–µ–π–¥—ñ—Ç—å –Ω–∞ –≤–∫–ª–∞–¥–∫—É **Permissions**
3. –ü—Ä–æ–∫—Ä—É—Ç—ñ—Ç—å –¥–æ **Cross-origin resource sharing (CORS)**
4. –î–æ–¥–∞–π—Ç–µ:
```json
[
    {
        "AllowedHeaders": ["*"],
        "AllowedMethods": ["GET", "PUT", "POST", "DELETE"],
        "AllowedOrigins": ["*"],
        "ExposeHeaders": []
    }
]
```

### 4. –°—Ç–≤–æ—Ä—ñ—Ç—å IAM –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –¥–ª—è –ø—Ä–æ–≥—Ä–∞–º–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø—É
1. AWS Console ‚Üí IAM ‚Üí Users
2. –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å **Add users**
3. –í–∫–∞–∂—ñ—Ç—å —ñ–º'—è: `propart-s3-user`
4. –í–∏–±–µ—Ä—ñ—Ç—å **Access key - Programmatic access**
5. –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å **Next: Permissions**
6. –í–∏–±–µ—Ä—ñ—Ç—å **Attach existing policies directly**
7. –ó–Ω–∞–π–¥—ñ—Ç—å —ñ –≤–∏–±–µ—Ä—ñ—Ç—å: `AmazonS3FullAccess` (–∞–±–æ —Å—Ç–≤–æ—Ä—ñ—Ç—å –≤–ª–∞—Å–Ω—É –ø–æ–ª—ñ—Ç–∏–∫—É –∑ –æ–±–º–µ–∂–µ–Ω–∏–º–∏ –ø—Ä–∞–≤–∞–º–∏)
8. –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å **Next** ‚Üí **Create user**
9. **–í–ê–ñ–õ–ò–í–û**: –ó–±–µ—Ä–µ–∂—ñ—Ç—å **Access Key ID** —Ç–∞ **Secret Access Key** (–≤–æ–Ω–∏ –±—ñ–ª—å—à–µ –Ω–µ –±—É–¥—É—Ç—å –ø–æ–∫–∞–∑–∞–Ω—ñ!)

### 5. –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ: –ü–æ–ª—ñ—Ç–∏–∫–∞ –∑ –æ–±–º–µ–∂–µ–Ω–∏–º–∏ –ø—Ä–∞–≤–∞–º–∏ (—Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–æ)
–ó–∞–º—ñ—Å—Ç—å `AmazonS3FullAccess` —Å—Ç–≤–æ—Ä—ñ—Ç—å –≤–ª–∞—Å–Ω—É –ø–æ–ª—ñ—Ç–∏–∫—É:
```json
{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Effect": "Allow",
            "Action": [
                "s3:PutObject",
                "s3:GetObject",
                "s3:DeleteObject",
                "s3:ListBucket"
            ],
            "Resource": [
                "arn:aws:s3:::your-bucket-name/*",
                "arn:aws:s3:::your-bucket-name"
            ]
        }
    ]
}
```

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª—ñ–≤ –≤ S3

–§–∞–π–ª–∏ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è –∑–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–æ—é:
```
user_documents/
  ‚îú‚îÄ‚îÄ {user_id}/
  ‚îÇ   ‚îú‚îÄ‚îÄ {uuid}.pdf
  ‚îÇ   ‚îú‚îÄ‚îÄ {uuid}.jpg
  ‚îÇ   ‚îî‚îÄ‚îÄ {uuid}.docx
  ‚îî‚îÄ‚îÄ ...
```

## –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è

1. –ü–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—å —â–æ –≤—Å—ñ –∑–º—ñ–Ω–Ω—ñ –¥–æ–¥–∞–Ω—ñ –¥–æ `.env`
2. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç—ñ—Ç—å —Å–µ—Ä–≤–µ—Ä
3. –°–ø—Ä–æ–±—É–π—Ç–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –¥–æ–∫—É–º–µ–Ω—Ç —á–µ—Ä–µ–∑ –∞–¥–º—ñ–Ω-–ø–∞–Ω–µ–ª—å
4. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ S3 bucket - —Ñ–∞–π–ª –º–∞—î –∑'—è–≤–∏—Ç–∏—Å—å —Ç–∞–º

## –ü—ñ–¥—Ç—Ä–∏–º—É–≤–∞–Ω—ñ —Ñ–æ—Ä–º–∞—Ç–∏ —Ñ–∞–π–ª—ñ–≤

- üìÑ PDF (`.pdf`)
- üìù Word (`.doc`, `.docx`)
- üñºÔ∏è –ó–æ–±—Ä–∞–∂–µ–Ω–Ω—è (`.jpg`, `.jpeg`, `.png`)
- üìã –¢–µ–∫—Å—Ç (`.txt`)

**–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∏–π —Ä–æ–∑–º—ñ—Ä —Ñ–∞–π–ª—É**: 10 MB

## –í–∞—Ä—Ç—ñ—Å—Ç—å

AWS S3 –º–∞—î –¥—É–∂–µ –Ω–∏–∑—å–∫—É –≤–∞—Ä—Ç—ñ—Å—Ç—å:
- –ó–±–µ—Ä—ñ–≥–∞–Ω–Ω—è: ~$0.023 –∑–∞ GB –Ω–∞ –º—ñ—Å—è—Ü—å
- –ó–∞–ø–∏—Ç–∏ GET: $0.0004 –∑–∞ 1000 –∑–∞–ø–∏—Ç—ñ–≤
- –ó–∞–ø–∏—Ç–∏ PUT: $0.005 –∑–∞ 1000 –∑–∞–ø–∏—Ç—ñ–≤

–î–ª—è –º–∞–ª–æ–≥–æ/—Å–µ—Ä–µ–¥–Ω—å–æ–≥–æ –ø—Ä–æ—î–∫—Ç—É —Ü–µ –±—É–¥–µ –∫–æ—à—Ç—É–≤–∞—Ç–∏ –º–µ–Ω—à–µ $1 –Ω–∞ –º—ñ—Å—è—Ü—å.

## Troubleshooting

### –ü–æ–º–∏–ª–∫–∞: "S3 –Ω–µ –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–æ"
- –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —â–æ –≤—Å—ñ –∑–º—ñ–Ω–Ω—ñ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ñ
- –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç—ñ—Ç—å —Å–µ—Ä–≤–µ—Ä –ø—ñ—Å–ª—è –¥–æ–¥–∞–≤–∞–Ω–Ω—è –∑–º—ñ–Ω–Ω–∏—Ö

### –ü–æ–º–∏–ª–∫–∞: "Access Denied"
- –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ IAM –ø—Ä–∞–≤–∞ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
- –ü–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—å —â–æ bucket —ñ—Å–Ω—É—î —ñ –º–∞—î –ø—Ä–∞–≤–∏–ª—å–Ω—É –Ω–∞–∑–≤—É
- –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —â–æ —Ä–µ–≥—ñ–æ–Ω –≤–∫–∞–∑–∞–Ω–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ

### –ü–æ–º–∏–ª–∫–∞: "Bucket does not exist"
- –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –Ω–∞–∑–≤—É bucket –≤ `.env`
- –ü–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—å —â–æ bucket —Å—Ç–≤–æ—Ä–µ–Ω–æ –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º—É —Ä–µ–≥—ñ–æ–Ω—ñ

## –ú—ñ–≥—Ä–∞—Ü—ñ—è —ñ—Å–Ω—É—é—á–∏—Ö —Ñ–∞–π–ª—ñ–≤

–Ø–∫—â–æ —É –≤–∞—Å –≤–∂–µ —î —Ñ–∞–π–ª–∏ –≤ –ª–æ–∫–∞–ª—å–Ω—ñ–π –ø–∞–ø—Ü—ñ `uploads/user_documents/`, —Å—Ç–≤–æ—Ä—ñ—Ç—å —Å–∫—Ä–∏–ø—Ç –¥–ª—è –º—ñ–≥—Ä–∞—Ü—ñ—ó:

```python
import os
import boto3
from app import app, db, UserDocument

def migrate_to_s3():
    s3_client = boto3.client('s3')
    bucket = app.config['AWS_S3_BUCKET']
    
    documents = UserDocument.query.all()
    for doc in documents:
        if os.path.exists(doc.file_path):
            # –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ —Ñ–∞–π–ª –≤ S3
            s3_path = f"user_documents/{doc.user_id}/{os.path.basename(doc.file_path)}"
            s3_client.upload_file(doc.file_path, bucket, s3_path)
            
            # –û–Ω–æ–≤–ª—é—î–º–æ —à–ª—è—Ö –≤ –ë–î
            doc.file_path = s3_path
    
    db.session.commit()
    print("‚úÖ –ú—ñ–≥—Ä–∞—Ü—ñ—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞!")

if __name__ == '__main__':
    with app.app_context():
        migrate_to_s3()
```

## –ë–µ–∑–ø–µ–∫–∞

- ‚úÖ Bucket –º–∞—î –±—É—Ç–∏ **–ø—Ä–∏–≤–∞—Ç–Ω–∏–º** (Block Public Access —É–≤—ñ–º–∫–Ω–µ–Ω–æ)
- ‚úÖ –§–∞–π–ª–∏ –¥–æ—Å—Ç—É–ø–Ω—ñ —Ç—ñ–ª—å–∫–∏ —á–µ—Ä–µ–∑ Flask –¥–æ–¥–∞—Ç–æ–∫ –∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—î—é
- ‚úÖ IAM –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –º–∞—î –º—ñ–Ω—ñ–º–∞–ª—å–Ω—ñ –Ω–µ–æ–±—Ö—ñ–¥–Ω—ñ –ø—Ä–∞–≤–∞
- ‚úÖ Access keys –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è –≤ `.env` (–Ω–µ –≤ git!)

