# üîß –í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –ø–æ–º–∏–ª–∫–∏ 502 Bad Gateway

## üéØ –ü—Ä–æ–±–ª–µ–º–∞
–°–∞–π—Ç `agent.pro-part.online/admin/users` –≤–∏–¥–∞—î –ø–æ–º–∏–ª–∫—É **502 Bad Gateway**.

–¶–µ –æ–∑–Ω–∞—á–∞—î, —â–æ Nginx –Ω–µ –º–æ–∂–µ –ø—ñ–¥–∫–ª—é—á–∏—Ç–∏—Å—è –¥–æ –≤–∞—à–æ–≥–æ –¥–æ–¥–∞—Ç–∫—É (Gunicorn).

---

## ‚ö° –®–í–ò–î–ö–ï –í–ò–ü–†–ê–í–õ–ï–ù–ù–Ø (5 —Ö–≤–∏–ª–∏–Ω)

### –í–∞—Ä—ñ–∞–Ω—Ç 1: –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è

–ü—ñ–¥–∫–ª—é—á—ñ—Ç—å—Å—è –¥–æ —Å–µ—Ä–≤–µ—Ä–∞ —á–µ—Ä–µ–∑ SSH —Ç–∞ –≤–∏–∫–æ–Ω–∞–π—Ç–µ:

```bash
# –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ —Å–∫—Ä–∏–ø—Ç –∑ GitHub
cd /var/www/propart
git pull

# –ó—Ä–æ–±–∏—Ç–∏ —Å–∫—Ä–∏–ø—Ç –≤–∏–∫–æ–Ω—É–≤–∞–Ω–∏–º
chmod +x RESTART_ALL_SERVICES.sh

# –ó–∞–ø—É—Å—Ç–∏—Ç–∏
sudo ./RESTART_ALL_SERVICES.sh
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –í—Å—ñ —Å–µ—Ä–≤—ñ—Å–∏ –±—É–¥—É—Ç—å –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω—ñ –∑–∞ 10 —Å–µ–∫—É–Ω–¥.

---

### –í–∞—Ä—ñ–∞–Ω—Ç 2: –†—É—á–Ω–µ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è

–í–∏–∫–æ–Ω–∞–π—Ç–µ –∫–æ–º–∞–Ω–¥–∏ –ø–æ —á–µ—Ä–∑—ñ:

```bash
# 1. –ó—É–ø–∏–Ω–∏—Ç–∏ Gunicorn
sudo pkill -9 gunicorn

# 2. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–∏ PostgreSQL
sudo systemctl restart postgresql

# 3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–∏ ProPart
sudo systemctl restart propart

# 4. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–∏ Nginx
sudo systemctl restart nginx

# 5. –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Å—Ç–∞—Ç—É—Å
sudo systemctl status propart
```

---

## üîç –î–Ü–ê–ì–ù–û–°–¢–ò–ö–ê (—è–∫—â–æ –Ω–µ –¥–æ–ø–æ–º–æ–≥–ª–æ)

–ó–∞–ø—É—Å—Ç—ñ—Ç—å –ø–æ–≤–Ω—É –¥—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫—É:

```bash
# –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ —Å–∫—Ä–∏–ø—Ç
cd /var/www/propart
chmod +x FIX_502_ERROR.sh

# –ó–∞–ø—É—Å—Ç–∏—Ç–∏ –¥—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫—É
sudo ./FIX_502_ERROR.sh
```

–¶–µ–π —Å–∫—Ä–∏–ø—Ç:
- ‚úÖ –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç—å –≤—Å—ñ —Å–µ—Ä–≤—ñ—Å–∏
- ‚úÖ –ü–æ–∫–∞–∂–µ –ª–æ–≥–∏ –ø–æ–º–∏–ª–æ–∫
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤–∏–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–æ–±–ª–µ–º—É
- ‚úÖ –ü—Ä–æ—Ç–µ—Å—Ç—É—î –≤–µ–±-—Å–µ—Ä–≤–µ—Ä

---

## üìã –ú–û–ñ–õ–ò–í–Ü –ü–†–ò–ß–ò–ù–ò –ü–û–ú–ò–õ–ö–ò

### 1. Gunicorn –Ω–µ –∑–∞–ø—É—â–µ–Ω–∏–π ‚ùå
**–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞:**
```bash
sudo systemctl status propart
```

**–í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è:**
```bash
sudo systemctl start propart
```

---

### 2. Gunicorn crashed —á–µ—Ä–µ–∑ –ø–æ–º–∏–ª–∫—É –≤ –∫–æ–¥—ñ ‚ùå
**–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞:**
```bash
sudo journalctl -u propart -n 50 --no-pager
```

**–í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è:**
```bash
# –ü–æ–¥–∏–≤–∏—Ç–∏—Å—å –ª–æ–≥–∏
tail -50 /var/log/propart/gunicorn_error.log

# –Ø–∫—â–æ —î –ø–æ–º–∏–ª–∫–∞ –≤ –∫–æ–¥—ñ - –≤–∏–ø—Ä–∞–≤–∏—Ç–∏ —Ç–∞ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–∏
cd /var/www/propart
git pull
sudo systemctl restart propart
```

---

### 3. PostgreSQL –Ω–µ –ø—Ä–∞—Ü—é—î ‚ùå
**–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞:**
```bash
sudo systemctl status postgresql
```

**–í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è:**
```bash
sudo systemctl restart postgresql
sudo systemctl restart propart
```

---

### 4. –ü–æ—Ä—Ç 8000 –∑–∞–π–Ω—è—Ç–∏–π —ñ–Ω—à–∏–º –ø—Ä–æ—Ü–µ—Å–æ–º ‚ùå
**–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞:**
```bash
sudo netstat -tlnp | grep :8000
```

**–í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è:**
```bash
# –í–±–∏—Ç–∏ –ø—Ä–æ—Ü–µ—Å —â–æ –∑–∞–π–º–∞—î –ø–æ—Ä—Ç
sudo pkill -9 gunicorn
sudo systemctl restart propart
```

---

### 5. –ù–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ –ø–∞–º'—è—Ç—ñ ‚ùå
**–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞:**
```bash
free -h
```

**–í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è:**
```bash
# –û—á–∏—Å—Ç–∏—Ç–∏ –∫–µ—à
sudo sh -c 'echo 3 > /proc/sys/vm/drop_caches'

# –ó–º–µ–Ω—à–∏—Ç–∏ –∫—ñ–ª—å–∫—ñ—Å—Ç—å Gunicorn workers
sudo nano /var/www/propart/gunicorn_config.py
# –ó–º—ñ–Ω–∏—Ç–∏ workers –Ω–∞ –º–µ–Ω—à—É –∫—ñ–ª—å–∫—ñ—Å—Ç—å (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, 2)

sudo systemctl restart propart
```

---

## üîÑ –¢–ò–ü–û–í–Ü –ö–û–ú–ê–ù–î–ò

### –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –≤—Å—å–æ–≥–æ
```bash
sudo systemctl restart postgresql propart nginx
```

### –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å—É
```bash
sudo systemctl status postgresql propart nginx
```

### –ü–µ—Ä–µ–≥–ª—è–¥ –ª–æ–≥—ñ–≤
```bash
# –õ–æ–≥–∏ Gunicorn
sudo tail -f /var/log/propart/gunicorn_error.log

# –õ–æ–≥–∏ —Å–∏—Å—Ç–µ–º–∏
sudo journalctl -u propart -f

# –õ–æ–≥–∏ Nginx
sudo tail -f /var/log/nginx/error.log
```

### –¢–µ—Å—Ç –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–∞
```bash
curl -I http://localhost:8000/
```

---

## ‚úÖ –ü–Ü–°–õ–Ø –í–ò–ü–†–ê–í–õ–ï–ù–ù–Ø

### 1. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä—ñ:
```
https://agent.pro-part.online/admin/users
```

### 2. –Ø–∫—â–æ –≤—Å–µ –ø—Ä–∞—Ü—é—î:
- ‚úÖ –°—Ç–æ—Ä—ñ–Ω–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂—É—î—Ç—å—Å—è
- ‚úÖ –ù–µ–º–∞—î –ø–æ–º–∏–ª–∫–∏ 502

### 3. –Ø–∫—â–æ –¥–æ—Å—ñ 502:
–ù–∞–¥—ñ—à–ª—ñ—Ç—å –º–µ–Ω—ñ –≤–∏–≤—ñ–¥:
```bash
sudo ./FIX_502_ERROR.sh > diagnostic.txt 2>&1
cat diagnostic.txt
```

---

## üìû –î–û–î–ê–¢–ö–û–í–ê –î–û–ü–û–ú–û–ì–ê

### –ü–æ–≤–Ω–∏–π —Å–ø–∏—Å–æ–∫ –ª–æ–≥—ñ–≤ –¥–ª—è –¥—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∏:
```bash
echo "=== GUNICORN LOGS ==="
sudo tail -50 /var/log/propart/gunicorn_error.log

echo ""
echo "=== SYSTEMD LOGS ==="
sudo journalctl -u propart -n 50 --no-pager

echo ""
echo "=== NGINX LOGS ==="
sudo tail -20 /var/log/nginx/error.log

echo ""
echo "=== POSTGRESQL LOGS ==="
sudo tail -20 /var/log/postgresql/postgresql-*.log
```

---

## üéØ –ó–ê–ü–û–ë–Ü–ì–ê–ù–ù–Ø –ü–†–û–ë–õ–ï–ú–Ü

### –ù–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–π –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥:

```bash
# –°—Ç–≤–æ—Ä–∏—Ç–∏ —Å–∫—Ä–∏–ø—Ç –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥—É
sudo nano /usr/local/bin/monitor_propart.sh
```

–î–æ–¥–∞—Ç–∏:
```bash
#!/bin/bash
if ! systemctl is-active --quiet propart; then
    echo "ProPart down, restarting..."
    systemctl restart propart
fi
```

–ó—Ä–æ–±–∏—Ç–∏ –≤–∏–∫–æ–Ω—É–≤–∞–Ω–∏–º:
```bash
sudo chmod +x /usr/local/bin/monitor_propart.sh
```

–î–æ–¥–∞—Ç–∏ –≤ cron (–∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω):
```bash
sudo crontab -e
# –î–æ–¥–∞—Ç–∏:
*/5 * * * * /usr/local/bin/monitor_propart.sh
```

---

## üìä –®–í–ò–î–ö–ê –î–Ü–ê–ì–ù–û–°–¢–ò–ö–ê

–í–∏–∫–æ–Ω–∞–π—Ç–µ —Ü—é –∫–æ–º–∞–Ω–¥—É —Ç–∞ –Ω–∞–¥—ñ—à–ª—ñ—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç:

```bash
echo "=== QUICK DIAGNOSTIC ==="
echo "PostgreSQL: $(sudo systemctl is-active postgresql)"
echo "ProPart: $(sudo systemctl is-active propart)"
echo "Nginx: $(sudo systemctl is-active nginx)"
echo "Port 8000: $(sudo netstat -tlnp | grep :8000 | wc -l) processes"
echo "HTTP Status: $(curl -s -o /dev/null -w '%{http_code}' http://localhost:8000/)"
echo "Last Error:"
sudo tail -3 /var/log/propart/gunicorn_error.log 2>/dev/null || echo "No errors"
```

---

## ‚ú® –†–ï–ó–£–õ–¨–¢–ê–¢

–ü—ñ—Å–ª—è –≤–∏–∫–æ–Ω–∞–Ω–Ω—è —Å–∫—Ä–∏–ø—Ç—ñ–≤ —Å–∞–π—Ç –º–∞—î:
- ‚úÖ –í—ñ–¥–∫—Ä–∏–≤–∞—Ç–∏—Å—è –±–µ–∑ –ø–æ–º–∏–ª–æ–∫
- ‚úÖ –ü–æ–∫–∞–∑—É–≤–∞—Ç–∏ —Å—Ç–æ—Ä—ñ–Ω–∫—É `/admin/users`
- ‚úÖ –í—Å—ñ —Å–µ—Ä–≤—ñ—Å–∏ –ø—Ä–∞—Ü—é—é—Ç—å —Å—Ç–∞–±—ñ–ª—å–Ω–æ

**–£—Å–ø—ñ—Ö—ñ–≤! üöÄ**

