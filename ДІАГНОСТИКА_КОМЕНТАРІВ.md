# üîç –î—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º–∏ –∑ –∫–æ–º–µ–Ω—Ç–∞—Ä—è–º–∏

## üìã –ü–æ–∫—Ä–æ–∫–æ–≤–∞ –¥—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

### –ö—Ä–æ–∫ 1: –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä—ñ

–í–∏–∫–æ–Ω–∞–π—Ç–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä—ñ:

```bash
cd /home/pro-part-agent/htdocs/agent.pro-part.online/propart-real-estate-hub
source venv/bin/activate
python3 test_note_creation.py
deactivate
```

–¶–µ –ø–æ–∫–∞–∂–µ:
- –ß–∏ –ø—Ä–∞—Ü—é—î —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è note
- –ß–∏ –ø—Ä–∞—Ü—é—î –∞—Å–æ—Ü—ñ–∞—Ü—ñ—è –∑ deal
- –Ø–∫—ñ —Å–∞–º–µ –ø–æ–º–∏–ª–∫–∏ –≤–∏–Ω–∏–∫–∞—é—Ç—å

---

### –ö—Ä–æ–∫ 2: –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ª–æ–≥—ñ–≤ –ø—ñ—Å–ª—è –¥–æ–¥–∞–≤–∞–Ω–Ω—è –∫–æ–º–µ–Ω—Ç–∞—Ä—è

–î–æ–¥–∞–π—Ç–µ –Ω–æ–≤–∏–π –∫–æ–º–µ–Ω—Ç–∞—Ä –¥–æ –ª—ñ–¥–∞, –ø–æ—Ç—ñ–º –ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ª–æ–≥–∏:

```bash
sudo journalctl -u propart -f --since "2 minutes ago" | grep -E "(comment|note|deal|–∞—Å–æ—Ü—ñ–∞—Ü—ñ—è|association|HubSpot|ERROR|‚ùå|‚úÖ)"
```

–®—É–∫–∞–π—Ç–µ:
- `üìù –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –∫–æ–º–µ–Ω—Ç–∞—Ä—è –¥–ª—è –ª—ñ–¥–∞` - –∫–æ–º–µ–Ω—Ç–∞—Ä –ø–æ—á–∞–≤ —Å—Ç–≤–æ—Ä—é–≤–∞—Ç–∏—Å—è
- `üìù –°—Ç–≤–æ—Ä—é—î—Ç—å—Å—è –Ω–æ—Ç–∞—Ç–∫–∞ –≤ HubSpot` - note –ø–æ—á–∞–ª–∞ —Å—Ç–≤–æ—Ä—é–≤–∞—Ç–∏—Å—è
- `‚úÖ –ù–æ—Ç–∞—Ç–∫–∞ —Å—Ç–≤–æ—Ä–µ–Ω–∞ –≤ HubSpot` - note —Å—Ç–≤–æ—Ä–µ–Ω–∞ —É—Å–ø—ñ—à–Ω–æ
- `üìù –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –∞—Å–æ—Ü—ñ–∞—Ü—ñ—ó note X –∑ deal Y` - –∞—Å–æ—Ü—ñ–∞—Ü—ñ—è –ø–æ—á–∞–ª–∞—Å—è
- `‚úÖ –ù–æ—Ç–∞—Ç–∫–∞ –∞—Å–æ—Ü—ñ–π–æ–≤–∞–Ω–∞ –∑ deal` - –∞—Å–æ—Ü—ñ–∞—Ü—ñ—è —É—Å–ø—ñ—à–Ω–∞
- `‚ùå` - –±—É–¥—å-—è–∫—ñ –ø–æ–º–∏–ª–∫–∏

---

### –ö—Ä–æ–∫ 3: –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —É–º–æ–≤

–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ, —á–∏ –≤–∏–∫–æ–Ω—É—é—Ç—å—Å—è –≤—Å—ñ —É–º–æ–≤–∏:

```bash
cd /home/pro-part-agent/htdocs/agent.pro-part.online/propart-real-estate-hub
source venv/bin/activate
python3 << 'EOF'
from app import app, db, Lead
with app.app_context():
    # –ó–Ω–∞—Ö–æ–¥–∏–º–æ –ª—ñ–¥ –∑ deal_id
    lead = Lead.query.filter(Lead.hubspot_deal_id.isnot(None)).first()
    if lead:
        print(f"‚úÖ –õ—ñ–¥ –∑–Ω–∞–π–¥–µ–Ω–æ: {lead.deal_name}")
        print(f"   Deal ID: {lead.hubspot_deal_id}")
        
        # –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ –∫–æ–º–µ–Ω—Ç–∞—Ä—ñ
        from app import Comment
        comments = Comment.query.filter_by(lead_id=lead.id).order_by(Comment.created_at.desc()).limit(5).all()
        print(f"\nüìù –û—Å—Ç–∞–Ω–Ω—ñ {len(comments)} –∫–æ–º–µ–Ω—Ç–∞—Ä—ñ–≤:")
        for c in comments:
            print(f"   - ID: {c.id}, hubspot_note_id: {c.hubspot_note_id or '‚ùå –ù–ï –°–ò–ù–•–†–û–ù–Ü–ó–û–í–ê–ù–û'}")
    else:
        print("‚ùå –õ—ñ–¥ –∑ hubspot_deal_id –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ")
EOF
deactivate
```

---

### –ö—Ä–æ–∫ 4: –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ API –∫–ª—é—á–∞

```bash
cd /home/pro-part-agent/htdocs/agent.pro-part.online/propart-real-estate-hub
cat .env | grep HUBSPOT_API_KEY
```

–ü–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—è, —â–æ –∫–ª—é—á –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ —Ç–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–∏–π.

---

## üîß –ú–æ–∂–ª–∏–≤—ñ –ø—Ä–æ–±–ª–µ–º–∏ —Ç–∞ —Ä—ñ—à–µ–Ω–Ω—è

### –ü—Ä–æ–±–ª–µ–º–∞ 1: Note —Å—Ç–≤–æ—Ä—é—î—Ç—å—Å—è, –∞–ª–µ –∞—Å–æ—Ü—ñ–∞—Ü—ñ—è –Ω–µ –ø—Ä–∞—Ü—é—î

**–°–∏–º–ø—Ç–æ–º–∏:**
- –í –ª–æ–≥–∞—Ö: `‚úÖ –ù–æ—Ç–∞—Ç–∫–∞ —Å—Ç–≤–æ—Ä–µ–Ω–∞ –≤ HubSpot`
- –í –ª–æ–≥–∞—Ö: `‚ùå –ê—Å–æ—Ü—ñ–∞—Ü—ñ—è –Ω–µ –≤–¥–∞–ª–∞—Å—è`

**–†—ñ—à–µ–Ω–Ω—è:**
1. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ø—Ä–∞–≤–∞ API –∫–ª—é—á–∞ - –≤—ñ–Ω –º–∞—î –º–∞—Ç–∏ –ø—Ä–∞–≤–∞ –Ω–∞ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è associations
2. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —Ñ–æ—Ä–º–∞—Ç deal_id - –≤—ñ–Ω –º–∞—î –±—É—Ç–∏ —á–∏—Å–ª–æ–º –±–µ–∑ –∑–∞–π–≤–∏—Ö —Å–∏–º–≤–æ–ª—ñ–≤
3. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ, —á–∏ deal —ñ—Å–Ω—É—î –≤ HubSpot

### –ü—Ä–æ–±–ª–µ–º–∞ 2: Note –Ω–µ —Å—Ç–≤–æ—Ä—é—î—Ç—å—Å—è –≤–∑–∞–≥–∞–ª—ñ

**–°–∏–º–ø—Ç–æ–º–∏:**
- –í –ª–æ–≥–∞—Ö: `‚ùå HTTP –∑–∞–ø–∏—Ç –Ω–µ –≤–¥–∞–≤—Å—è`
- –í –ª–æ–≥–∞—Ö: `‚ö†Ô∏è HUBSPOT_API_KEY –Ω–µ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ`

**–†—ñ—à–µ–Ω–Ω—è:**
1. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ HUBSPOT_API_KEY –≤ .env —Ñ–∞–π–ª—ñ
2. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç—ñ—Ç—å —Å–µ—Ä–≤—ñ—Å –ø—ñ—Å–ª—è –∑–º—ñ–Ω–∏ .env
3. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ø—Ä–∞–≤–∞ API –∫–ª—é—á–∞ - –≤—ñ–Ω –º–∞—î –º–∞—Ç–∏ –ø—Ä–∞–≤–∞ –Ω–∞ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è notes

### –ü—Ä–æ–±–ª–µ–º–∞ 3: –ö–æ–º–µ–Ω—Ç–∞—Ä —Å—Ç–≤–æ—Ä—é—î—Ç—å—Å—è, –∞–ª–µ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è –Ω–µ –ø–æ—á–∏–Ω–∞—î—Ç—å—Å—è

**–°–∏–º–ø—Ç–æ–º–∏:**
- –ö–æ–º–µ–Ω—Ç–∞—Ä –∑'—è–≤–ª—è—î—Ç—å—Å—è –≤ —Å–∏—Å—Ç–µ–º—ñ
- –í –ª–æ–≥–∞—Ö –Ω–µ–º–∞—î –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å –ø—Ä–æ HubSpot

**–†—ñ—à–µ–Ω–Ω—è:**
1. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ, —á–∏ –ª—ñ–¥ –º–∞—î `hubspot_deal_id`
2. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ª–æ–≥–∏ –Ω–∞ –Ω–∞—è–≤–Ω—ñ—Å—Ç—å –ø–æ–º–∏–ª–æ–∫ –ø—Ä–∏ —ñ–º–ø–æ—Ä—Ç—ñ –º–æ–¥—É–ª—ñ–≤

---

## üìä –î–µ—Ç–∞–ª—å–Ω–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ª–æ–≥—ñ–≤

–í–∏–∫–æ–Ω–∞–π—Ç–µ —Ü—é –∫–æ–º–∞–Ω–¥—É –¥–ª—è –ø–æ–≤–Ω–æ–≥–æ –∞–Ω–∞–ª—ñ–∑—É:

```bash
sudo journalctl -u propart -n 1000 | grep -E "(comment|note|deal|HubSpot|ERROR|‚ùå|‚úÖ|‚ö†Ô∏è)" | tail -50
```

–¶–µ –ø–æ–∫–∞–∂–µ –æ—Å—Ç–∞–Ω–Ω—ñ 50 –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å, –ø–æ–≤'—è–∑–∞–Ω–∏—Ö –∑ –∫–æ–º–µ–Ω—Ç–∞—Ä—è–º–∏ —Ç–∞ HubSpot.

---

## üß™ –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –≤—Ä—É—á–Ω—É

–Ø–∫—â–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è –Ω–µ –ø—Ä–∞—Ü—é—î, —Å–ø—Ä–æ–±—É–π—Ç–µ —Å—Ç–≤–æ—Ä–∏—Ç–∏ note –≤—Ä—É—á–Ω—É —á–µ—Ä–µ–∑ curl:

```bash
# –û—Ç—Ä–∏–º–∞–π—Ç–µ API –∫–ª—é—á —Ç–∞ deal_id –∑ .env —Ç–∞ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö
API_KEY="–≤–∞—à-–∫–ª—é—á"
DEAL_ID="379053205752"  # –ó –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è

# –°—Ç–≤–æ—Ä—ñ—Ç—å note
curl -X POST "https://api.hubapi.com/crm/v3/objects/notes" \
  -H "Authorization: Bearer $API_KEY" \
  -H "Content-Type: application/json" \
  -d '{
    "properties": {
      "hs_note_body": "–¢–µ—Å—Ç–æ–≤–∏–π –∫–æ–º–µ–Ω—Ç–∞—Ä",
      "hs_timestamp": "2024-01-01T00:00:00Z"
    }
  }'

# –ó–∞–ø–∞–º'—è—Ç–∞–π—Ç–µ note_id –∑ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ, –ø–æ—Ç—ñ–º —Å—Ç–≤–æ—Ä—ñ—Ç—å –∞—Å–æ—Ü—ñ–∞—Ü—ñ—é:
NOTE_ID="–æ—Ç—Ä–∏–º–∞–Ω–∏–π-note-id"

curl -X POST "https://api.hubapi.com/crm/v4/associations/notes/deals/batch/create" \
  -H "Authorization: Bearer $API_KEY" \
  -H "Content-Type: application/json" \
  -d "{
    \"inputs\": [{
      \"from\": { \"id\": \"$NOTE_ID\" },
      \"to\": { \"id\": \"$DEAL_ID\" },
      \"type\": \"note_to_deal\"
    }]
  }"
```

---

## üí° –ù–∞—Å—Ç—É–ø–Ω—ñ –∫—Ä–æ–∫–∏

–ü—ñ—Å–ª—è –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –¥—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∏:

1. **–ù–∞–¥—ñ—à–ª—ñ—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏** `test_note_creation.py`
2. **–ù–∞–¥—ñ—à–ª—ñ—Ç—å –ª–æ–≥–∏** –ø—ñ—Å–ª—è –¥–æ–¥–∞–≤–∞–Ω–Ω—è –∫–æ–º–µ–Ω—Ç–∞—Ä—è
3. **–í–∫–∞–∂—ñ—Ç—å**, –Ω–∞ —è–∫–æ–º—É –µ—Ç–∞–ø—ñ –≤–∏–Ω–∏–∫–∞—î –ø—Ä–æ–±–ª–µ–º–∞:
   - –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –∫–æ–º–µ–Ω—Ç–∞—Ä—è –≤ —Å–∏—Å—Ç–µ–º—ñ
   - –°—Ç–≤–æ—Ä–µ–Ω–Ω—è note –≤ HubSpot
   - –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –∞—Å–æ—Ü—ñ–∞—Ü—ñ—ó –∑ deal

–¶–µ –¥–æ–ø–æ–º–æ–∂–µ —Ç–æ—á–Ω–æ –≤–∏–∑–Ω–∞—á–∏—Ç–∏ –ø—Ä–æ–±–ª–µ–º—É!

