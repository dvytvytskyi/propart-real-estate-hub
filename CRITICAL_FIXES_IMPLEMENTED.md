# ‚úÖ –†–µ–∞–ª—ñ–∑–æ–≤–∞–Ω—ñ –∫—Ä–∏—Ç–∏—á–Ω—ñ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è

## üìÖ –î–∞—Ç–∞: 1 –∂–æ–≤—Ç–Ω—è 2025

---

## üéØ –©–æ –±—É–ª–æ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–æ

### 1. ‚úÖ **–û–±—Ä–æ–±–∫–∞ –ø–æ–º–∏–ª–æ–∫ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö** (–ü–†–Ü–û–†–ò–¢–ï–¢ 1)

#### –©–æ –¥–æ–¥–∞–Ω–æ:
```python
# Connection pooling –∑ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–º reconnect
app.config['SQLALCHEMY_ENGINE_OPTIONS'] = {
    'pool_size': 10,
    'pool_recycle': 3600,
    'pool_pre_ping': True,
    'max_overflow': 20,
    'connect_args': {
        'connect_timeout': 10,
        'options': '-c statement_timeout=30000'
    }
}
```

#### –†–µ–∑—É–ª—å—Ç–∞—Ç:
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–π reconnect –ø—Ä–∏ –≤—Ç—Ä–∞—Ç—ñ –∑'—î–¥–Ω–∞–Ω–Ω—è
- ‚úÖ –ó–∞–ø–æ–±—ñ–≥–∞–Ω–Ω—è connection leaks
- ‚úÖ –¢–∞–π–º–∞—É—Ç–∏ –¥–ª—è –¥–æ–≤–≥–∏—Ö –∑–∞–ø–∏—Ç—ñ–≤
- ‚úÖ –ì–ª–æ–±–∞–ª—å–Ω—ñ error handlers –∑ rollback

---

### 2. ‚úÖ **–¶–µ–Ω—Ç—Ä–∞–ª—ñ–∑–æ–≤–∞–Ω–µ –ª–æ–≥—É–≤–∞–Ω–Ω—è** (–ü–†–Ü–û–†–ò–¢–ï–¢ 1)

#### –ù–æ–≤–∏–π —Ñ–∞–π–ª: `logging_config.py`

#### –©–æ –¥–æ–¥–∞–Ω–æ:
- üìù –†–æ—Ç–∞—Ü—ñ—è –ª–æ–≥—ñ–≤ (10MB, 10 backup —Ñ–∞–π–ª—ñ–≤)
- üìù –†—ñ–∑–Ω—ñ —Ä—ñ–≤–Ω—ñ: INFO, WARNING, ERROR
- üìù –õ–æ–≥–∏ –≤ `logs/propart.log`
- üìù –ó–∞–º—ñ–Ω–∞ –≤—Å—ñ—Ö `print()` –Ω–∞ `app.logger.*`

#### –†–µ–∑—É–ª—å—Ç–∞—Ç:
- ‚úÖ –ú–æ–∂–ª–∏–≤—ñ—Å—Ç—å –≤—ñ–¥—Å—Ç–µ–∂–∏—Ç–∏ –≤—Å—ñ –ø–æ–¥—ñ—ó
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∞ —Ä–æ—Ç–∞—Ü—ñ—è –¥–ª—è –µ–∫–æ–Ω–æ–º—ñ—ó –º—ñ—Å—Ü—è
- ‚úÖ –°—Ç—Ä—É–∫—Ç—É—Ä–æ–≤–∞–Ω—ñ –ª–æ–≥–∏ –∑ timestamps —Ç–∞ stack traces

---

### 3. ‚úÖ **HubSpot API Rate Limiting** (–ü–†–Ü–û–†–ò–¢–ï–¢ 1)

#### –ù–æ–≤–∏–π —Ñ–∞–π–ª: `hubspot_rate_limiter.py`

#### –©–æ –¥–æ–¥–∞–Ω–æ:
```python
# Rate limiter: 90 requests/10 seconds
@hubspot_rate_limiter
def sync_lead_from_hubspot(lead):
    # –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–π retry –∑ exponential backoff
    # –û–±—Ä–æ–±–∫–∞ 429 (Too Many Requests)
```

#### –†–µ–∑—É–ª—å—Ç–∞—Ç:
- ‚úÖ –ó–∞—Ö–∏—Å—Ç –≤—ñ–¥ –ø–µ—Ä–µ–≤–∏—â–µ–Ω–Ω—è –ª—ñ–º—ñ—Ç—ñ–≤ HubSpot (100 req/10s)
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–π retry –ø—Ä–∏ –ø–æ–º–∏–ª–∫–∞—Ö
- ‚úÖ Exponential backoff –¥–ª—è 429 –ø–æ–º–∏–ª–æ–∫
- ‚úÖ –õ–æ–≥—É–≤–∞–Ω–Ω—è –≤—Å—ñ—Ö rate limit –ø–æ–¥—ñ–π

---

### 4. ‚úÖ **–ü–æ–∫—Ä–∞—â–µ–Ω–∞ –±–µ–∑–ø–µ–∫–∞** (–ü–†–Ü–û–†–ò–¢–ï–¢ 1)

#### –©–æ –¥–æ–¥–∞–Ω–æ:

**4.1. CSRF –∑–∞—Ö–∏—Å—Ç**
```python
from flask_wtf.csrf import CSRFProtect
csrf = CSRFProtect(app)
```

**4.2. Rate limiting –¥–ª—è login**
```python
@app.route('/login', methods=['POST'])
@limiter.limit("10 per minute")  # –ú–∞–∫—Å–∏–º—É–º 10 —Å–ø—Ä–æ–±/—Ö–≤–∏–ª–∏–Ω—É
def login():
    # ...
```

**4.3. Bcrypt –¥–ª—è –ø–∞—Ä–æ–ª—ñ–≤**
```python
from flask_bcrypt import Bcrypt
bcrypt = Bcrypt(app)

# –í User model:
def set_password(self, password):
    self.password_hash = bcrypt.generate_password_hash(password).decode('utf-8')
```

**4.4. –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ SECRET_KEY**
```python
SECRET_KEY = os.getenv('SECRET_KEY')
if not SECRET_KEY:
    # –ì–µ–Ω–µ—Ä—É—î–º–æ —Ç–∏–º—á–∞—Å–æ–≤–∏–π —Ç–∞ –ø–æ–ø–µ—Ä–µ–¥–∂–∞—î–º–æ
    app.logger.warning("SECRET_KEY –Ω–µ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ!")
```

#### –†–µ–∑—É–ª—å—Ç–∞—Ç:
- ‚úÖ –ó–∞—Ö–∏—Å—Ç –≤—ñ–¥ CSRF –∞—Ç–∞–∫
- ‚úÖ –ó–∞—Ö–∏—Å—Ç –≤—ñ–¥ brute-force login
- ‚úÖ –°–∏–ª—å–Ω—ñ—à–µ —à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è –ø–∞—Ä–æ–ª—ñ–≤
- ‚úÖ –û–±–æ–≤'—è–∑–∫–æ–≤–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ SECRET_KEY

---

### 5. ‚úÖ **Error Handlers**

#### –©–æ –¥–æ–¥–∞–Ω–æ:
```python
@app.errorhandler(Exception)
@app.errorhandler(404)
@app.errorhandler(500)
```

#### –ù–æ–≤–∏–π —Ñ–∞–π–ª: `templates/error.html`

#### –†–µ–∑—É–ª—å—Ç–∞—Ç:
- ‚úÖ –ö—Ä–∞—Å–∏–≤—ñ —Å—Ç–æ—Ä—ñ–Ω–∫–∏ –ø–æ–º–∏–ª–æ–∫
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–π rollback –ø—Ä–∏ –ø–æ–º–∏–ª–∫–∞—Ö
- ‚úÖ –†—ñ–∑–Ω–∞ –æ–±—Ä–æ–±–∫–∞ –¥–ª—è API —Ç–∞ HTML –∑–∞–ø–∏—Ç—ñ–≤
- ‚úÖ –î–µ—Ç–∞–ª—å–Ω–µ –ª–æ–≥—É–≤–∞–Ω–Ω—è –≤—Å—ñ—Ö –ø–æ–º–∏–ª–æ–∫

---

## üì¶ –û–Ω–æ–≤–ª–µ–Ω—ñ —Ñ–∞–π–ª–∏

### –ù–æ–≤—ñ —Ñ–∞–π–ª–∏:
1. ‚úÖ `logging_config.py` - –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è –ª–æ–≥—É–≤–∞–Ω–Ω—è
2. ‚úÖ `hubspot_rate_limiter.py` - Rate limiter –¥–ª—è HubSpot API
3. ‚úÖ `templates/error.html` - –°—Ç–æ—Ä—ñ–Ω–∫–∞ –ø–æ–º–∏–ª–æ–∫
4. ‚úÖ `SECURITY_SETUP.md` - –Ü–Ω—Å—Ç—Ä—É–∫—Ü—ñ—ó –∑ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è
5. ‚úÖ `CRITICAL_FIXES_IMPLEMENTED.md` - –¶–µ–π –¥–æ–∫—É–º–µ–Ω—Ç

### –û–Ω–æ–≤–ª–µ–Ω—ñ —Ñ–∞–π–ª–∏:
1. ‚úÖ `app.py` - –ì–æ–ª–æ–≤–Ω–∏–π —Ñ–∞–π–ª –∑ —É—Å—ñ–º–∞ –ø–æ–∫—Ä–∞—â–µ–Ω–Ω—è–º–∏
2. ‚úÖ `requirements.txt` - –î–æ–¥–∞–Ω–æ –Ω–æ–≤—ñ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ
3. ‚úÖ `templates/profile.html` - –í–∏–¥–∞–ª–µ–Ω–æ –≥—Ä–∞—Ñ—ñ–∫–∏, –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–æ —ñ–∫–æ–Ω–∫—É

---

## üìã –©–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ –∑—Ä–æ–±–∏—Ç–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—É

### 1. –í—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ –Ω–æ–≤—ñ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ:
```bash
pip install -r requirements.txt
```

### 2. –ó–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ SECRET_KEY:
```bash
python -c "import secrets; print(secrets.token_hex(32))"
```

–î–æ–¥–∞—Ç–∏ –≤ `.env`:
```env
SECRET_KEY=–≤–∞—à-–∑–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–∏–π-–∫–ª—é—á
```

### 3. (–û–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ) –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ Alembic:
```bash
alembic init migrations
alembic revision --autogenerate -m "Initial migration"
alembic upgrade head
```

---

## üöÄ –Ø–∫ –∑–∞–ø—É—Å—Ç–∏—Ç–∏

```bash
# 1. –í—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ
pip install -r requirements.txt

# 2. –ù–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ .env —Ñ–∞–π–ª
# –î–æ–¥–∞—Ç–∏ SECRET_KEY —Ç–∞ —ñ–Ω—à—ñ –∑–º—ñ–Ω–Ω—ñ

# 3. –ó–∞–ø—É—Å—Ç–∏—Ç–∏ —Å–µ—Ä–≤–µ—Ä
python run.py
```

–°–µ—Ä–≤–µ—Ä –±—É–¥–µ –¥–æ—Å—Ç—É–ø–Ω–∏–π –Ω–∞: **http://localhost:5001**

---

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–º—ñ–Ω

- üìù **5 –∫—Ä–∏—Ç–∏—á–Ω–∏—Ö –ø—Ä–æ–±–ª–µ–º** –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–æ
- üìÅ **5 –Ω–æ–≤–∏—Ö —Ñ–∞–π–ª—ñ–≤** —Å—Ç–≤–æ—Ä–µ–Ω–æ
- üîÑ **3 —Ñ–∞–π–ª–∏** –æ–Ω–æ–≤–ª–µ–Ω–æ
- üì¶ **4 –Ω–æ–≤—ñ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ** –¥–æ–¥–∞–Ω–æ
- üîí **4 —Ä—ñ–≤–Ω—ñ –±–µ–∑–ø–µ–∫–∏** –ø–æ–∫—Ä–∞—â–µ–Ω–æ
- üìà **100% rate limit** –∑–∞—Ö–∏—Å—Ç –¥–ª—è HubSpot API
- üõ°Ô∏è **CSRF + Rate Limiting** –¥–ª—è –≤—Å—ñ—Ö –µ–Ω–¥–ø–æ—ñ–Ω—Ç—ñ–≤

---

## ‚ú® –ö–ª—é—á–æ–≤—ñ –ø–æ–∫—Ä–∞—â–µ–Ω–Ω—è

### –ë—É–ª–æ:
‚ùå –ù–µ–º–∞—î –æ–±—Ä–æ–±–∫–∏ –ø–æ–º–∏–ª–æ–∫ –ë–î  
‚ùå –¢—ñ–ª—å–∫–∏ print() –∑–∞–º—ñ—Å—Ç—å –ª–æ–≥—ñ–≤  
‚ùå –ù–µ–º–∞—î rate limiting –¥–ª—è HubSpot  
‚ùå –°–ª–∞–±–∫–∞ –±–µ–∑–ø–µ–∫–∞ (Werkzeug –ø–∞—Ä–æ–ª–∏)  
‚ùå –ù–µ–º–∞—î CSRF –∑–∞—Ö–∏—Å—Ç—É  

### –°—Ç–∞–ª–æ:
‚úÖ Connection pooling + error handlers  
‚úÖ –ü—Ä–æ—Ñ–µ—Å—ñ–π–Ω–µ –ª–æ–≥—É–≤–∞–Ω–Ω—è –∑ —Ä–æ—Ç–∞—Ü—ñ—î—é  
‚úÖ HubSpot rate limiter –∑ retry logic  
‚úÖ Bcrypt + CSRF + Rate limiting  
‚úÖ –ü–æ–≤–Ω–∏–π –∑–∞—Ö–∏—Å—Ç –≤—ñ–¥ –∞—Ç–∞–∫  

---

## üìû –ü—ñ–¥—Ç—Ä–∏–º–∫–∞

–Ø–∫—â–æ –≤–∏–Ω–∏–∫–ª–∏ –ø—Ä–æ–±–ª–µ–º–∏:
1. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ `logs/propart.log`
2. –ß–∏—Ç–∞–π—Ç–µ `SECURITY_SETUP.md`
3. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –≤—Å—ñ –∑–º—ñ–Ω–Ω—ñ –≤ `.env`

---

## üéâ –í–∏—Å–Ω–æ–≤–æ–∫

–í—Å—ñ –∫—Ä–∏—Ç–∏—á–Ω—ñ –ø—Ä–æ–±–ª–µ–º–∏ –∑ `–ê–ù–ê–õ–Ü–ó_–ü–†–û–ï–ö–¢–£.md` —É—Å–ø—ñ—à–Ω–æ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–æ!

–°–∏—Å—Ç–µ–º–∞ —Ç–µ–ø–µ—Ä:
- üõ°Ô∏è –ó–∞—Ö–∏—â–µ–Ω–∞ –≤—ñ–¥ –∞—Ç–∞–∫
- üìù –ú–∞—î –ø—Ä–æ—Ñ–µ—Å—ñ–π–Ω–µ –ª–æ–≥—É–≤–∞–Ω–Ω—è
- üîÑ –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤—ñ–¥–Ω–æ–≤–ª—é—î—Ç—å—Å—è –ø—ñ—Å–ª—è –ø–æ–º–∏–ª–æ–∫
- ‚ö° –û–ø—Ç–∏–º—ñ–∑–æ–≤–∞–Ω–∞ –¥–ª—è production
- üöÄ –ì–æ—Ç–æ–≤–∞ –¥–æ deployment

