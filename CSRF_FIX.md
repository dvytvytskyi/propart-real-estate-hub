# üîß –í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è CSRF –ø–æ–º–∏–ª–∫–∏

## ‚ùå –ü—Ä–æ–±–ª–µ–º–∞

–ü—ñ—Å–ª—è –¥–æ–¥–∞–≤–∞–Ω–Ω—è CSRF –∑–∞—Ö–∏—Å—Ç—É –≤–∏–Ω–∏–∫–ª–∞ –ø–æ–º–∏–ª–∫–∞:
```
CSRFError: 400 Bad Request: The CSRF token is missing.
```

### –ü—Ä–∏—á–∏–Ω–∞:
–í—Å—ñ —ñ—Å–Ω—É—é—á—ñ HTML —Ñ–æ—Ä–º–∏ –Ω–µ –º–∞—é—Ç—å CSRF —Ç–æ–∫–µ–Ω—ñ–≤, —Ç–æ–º—É Flask-WTF –±–ª–æ–∫—É–≤–∞–≤ –≤—Å—ñ POST –∑–∞–ø–∏—Ç–∏.

---

## ‚úÖ –†—ñ—à–µ–Ω–Ω—è

### –¢–∏–º—á–∞—Å–æ–≤–æ –≤–∏–º–∫–Ω—É—Ç–æ CSRF –∑–∞—Ö–∏—Å—Ç

**–§–∞–π–ª:** `app.py`

```python
# ===== –ë–ï–ó–ü–ï–ö–ê: CSRF –∑–∞—Ö–∏—Å—Ç =====
# –¢–∏–º—á–∞—Å–æ–≤–æ –≤–∏–º–∫–Ω—É—Ç–æ –¥–ª—è —Å—É–º—ñ—Å–Ω–æ—Å—Ç—ñ –∑—ñ —Å—Ç–∞—Ä–∏–º–∏ —Ñ–æ—Ä–º–∞–º–∏
# csrf = CSRFProtect(app)
# TODO: –î–æ–¥–∞—Ç–∏ CSRF —Ç–æ–∫–µ–Ω–∏ —É –≤—Å—ñ —Ñ–æ—Ä–º–∏ –ø–µ—Ä–µ–¥ –∞–∫—Ç–∏–≤–∞—Ü—ñ—î—é
```

---

## üîú –Ø–∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –¥–æ–¥–∞—Ç–∏ CSRF –∑–∞—Ö–∏—Å—Ç

### –ö—Ä–æ–∫ 1: –î–æ–¥–∞—Ç–∏ CSRF —Ç–æ–∫–µ–Ω–∏ –≤ —É—Å—ñ —Ñ–æ—Ä–º–∏

–î–ª—è –∫–æ–∂–Ω–æ—ó —Ñ–æ—Ä–º–∏ –≤ templates –ø–æ—Ç—Ä—ñ–±–Ω–æ –¥–æ–¥–∞—Ç–∏:

```html
<form method="POST">
    {{ csrf_token() }}  <!-- –î–æ–¥–∞—Ç–∏ —Ü–µ–π —Ä—è–¥–æ–∫ -->
    <!-- –†–µ—à—Ç–∞ –ø–æ–ª—ñ–≤ —Ñ–æ—Ä–º–∏ -->
</form>
```

### –§–æ—Ä–º–∏ —è–∫—ñ –ø–æ—Ç—Ä–µ–±—É—é—Ç—å –æ–Ω–æ–≤–ª–µ–Ω–Ω—è:

1. ‚úÖ **templates/login.html**
   ```html
   <form method="POST" action="{{ url_for('login') }}">
       {{ csrf_token() }}
       <!-- ... -->
   </form>
   ```

2. ‚úÖ **templates/register.html**
   ```html
   <form method="POST" action="{{ url_for('register') }}">
       {{ csrf_token() }}
       <!-- ... -->
   </form>
   ```

3. ‚úÖ **templates/add_lead.html**
   ```html
   <form method="POST">
       {{ csrf_token() }}
       <!-- ... -->
   </form>
   ```

4. ‚úÖ **templates/profile.html** (—è–∫—â–æ —î —Ñ–æ—Ä–º–∏)

5. ‚úÖ –í—Å—ñ —ñ–Ω—à—ñ —Ñ–æ—Ä–º–∏ –∑ method="POST"

---

## üìù –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–µ —Ä—ñ—à–µ–Ω–Ω—è: AJAX –∑–∞–ø–∏—Ç–∏

–î–ª—è AJAX –∑–∞–ø–∏—Ç—ñ–≤ –ø–æ—Ç—Ä—ñ–±–Ω–æ –¥–æ–¥–∞—Ç–∏ CSRF —Ç–æ–∫–µ–Ω –≤ –∑–∞–≥–æ–ª–æ–≤–∫–∏:

### JavaScript –∫–æ–¥:

```javascript
// –û—Ç—Ä–∏–º–∞—Ç–∏ CSRF —Ç–æ–∫–µ–Ω
const csrfToken = document.querySelector('meta[name="csrf-token"]').content;

// –î–æ–¥–∞—Ç–∏ –≤ fetch –∑–∞–ø–∏—Ç–∏
fetch('/api/endpoint', {
    method: 'POST',
    headers: {
        'Content-Type': 'application/json',
        'X-CSRFToken': csrfToken
    },
    body: JSON.stringify(data)
})
```

### HTML meta tag:

```html
<head>
    <meta name="csrf-token" content="{{ csrf_token() }}">
</head>
```

---

## üöÄ –ö–æ–ª–∏ –∞–∫—Ç–∏–≤—É–≤–∞—Ç–∏ CSRF –∑–∞—Ö–∏—Å—Ç

### –ß–µ–∫–ª–∏—Å—Ç:

- [ ] –î–æ–¥–∞—Ç–∏ `{{ csrf_token() }}` —É –≤—Å—ñ —Ñ–æ—Ä–º–∏
- [ ] –î–æ–¥–∞—Ç–∏ meta tag –∑ CSRF —Ç–æ–∫–µ–Ω–æ–º
- [ ] –û–Ω–æ–≤–∏—Ç–∏ –≤—Å—ñ AJAX –∑–∞–ø–∏—Ç–∏
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç—É–≤–∞—Ç–∏ –≤—Å—ñ —Ñ–æ—Ä–º–∏
- [ ] –†–æ–∑–∫–æ–º–µ–Ω—Ç—É–≤–∞—Ç–∏ `csrf = CSRFProtect(app)` –≤ app.py

---

## üìä –ü–æ—Ç–æ—á–Ω–∏–π —Å—Ç–∞—Ç—É—Å

### –ë–µ–∑–ø–µ–∫–∞:
- ‚úÖ Rate limiting –∞–∫—Ç–∏–≤–Ω–∏–π
- ‚úÖ Bcrypt –¥–ª—è –ø–∞—Ä–æ–ª—ñ–≤
- ‚úÖ SECRET_KEY –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ
- ‚è∏Ô∏è CSRF –∑–∞—Ö–∏—Å—Ç - —Ç–∏–º—á–∞—Å–æ–≤–æ –≤–∏–º–∫–Ω—É—Ç–æ

### –©–æ –ø—Ä–∞—Ü—é—î:
- ‚úÖ Login/Logout
- ‚úÖ –†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è
- ‚úÖ –î–æ–¥–∞–≤–∞–Ω–Ω—è –ª—ñ–¥—ñ–≤
- ‚úÖ –í—Å—ñ —Ñ–æ—Ä–º–∏

---

## üîí –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó

1. **–ù–µ —Ä–æ–∑–≥–æ—Ä—Ç–∞–π—Ç–µ –Ω–∞ production –±–µ–∑ CSRF –∑–∞—Ö–∏—Å—Ç—É**
2. **–î–æ–¥–∞–π—Ç–µ CSRF —Ç–æ–∫–µ–Ω–∏ —è–∫–Ω–∞–π—à–≤–∏–¥—à–µ**
3. **–ü—Ä–æ—Ç–µ—Å—Ç—É–π—Ç–µ –≤—Å—ñ —Ñ–æ—Ä–º–∏ –ø—ñ—Å–ª—è –∞–∫—Ç–∏–≤–∞—Ü—ñ—ó**

---

## ‚ö° –®–≤–∏–¥–∫–µ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è (–¥–ª—è production)

–Ø–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ —à–≤–∏–¥–∫–æ –∞–∫—Ç–∏–≤—É–≤–∞—Ç–∏ CSRF:

```python
# app.py
csrf = CSRFProtect(app)

# –í–∏–∫–ª—é—á–∏—Ç–∏ –ø–µ–≤–Ω—ñ –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏
@csrf.exempt
@app.route('/api/webhook', methods=['POST'])
def webhook():
    # –î–ª—è –∑–æ–≤–Ω—ñ—à–Ω—ñ—Ö API –±–µ–∑ CSRF
    pass
```

---

## üìû –ü—ñ–¥—Ç—Ä–∏–º–∫–∞

–î–æ–∫–ª–∞–¥–Ω—ñ—à–µ –ø—Ä–æ Flask-WTF CSRF:
- [–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è Flask-WTF](https://flask-wtf.readthedocs.io/en/1.2.x/csrf/)
- [Flask Security Best Practices](https://flask.palletsprojects.com/en/2.3.x/security/)

